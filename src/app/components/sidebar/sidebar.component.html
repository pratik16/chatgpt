<div
  class="relative h-full bg-sidebar border-r border-sidebar-border flex flex-col"
  [style.width]="isCollapsed ? '60px' : width + 'px'"
  [style.transition]="'width 0.3s cubic-bezier(0.4, 0, 0.2, 1)'">
  
  <!-- Collapse Toggle Button -->
  <button
    type="button"
    (click)="toggleCollapse.emit()"
    class="absolute -right-3 top-4 z-10 h-6 w-6 rounded-full border border-sidebar-border bg-sidebar hover:bg-sidebar-accent shadow-md transition-all hover:shadow-lg flex items-center justify-center">
    <svg *ngIf="isCollapsed" class="h-3 w-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
    </svg>
    <svg *ngIf="!isCollapsed" class="h-3 w-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
    </svg>
  </button>

  <!-- New Chat Button -->
  <div class="p-3 border-b border-sidebar-border">
    <button
      type="button"
      (click)="createNewChat()"
      class="w-full justify-start gap-2 btn btn-primary flex items-center px-3 py-2 font-medium rounded-lg">
      <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
      </svg>
      <span *ngIf="!isCollapsed">New Chat</span>
    </button>
  </div>

  <!-- Chat History -->
  <div class="flex-1 px-2 overflow-y-auto">
    <div class="space-y-1 py-2">
      <div *ngIf="loading$ | async" class="text-center text-muted-foreground text-sm py-4">
        Loading...
      </div>
      
      <div *ngIf="!(loading$ | async)">
        <div
          *ngFor="let chat of chats$ | async"
          (click)="selectChat(chat.id)"
          [class]="'w-full text-left px-3 py-2 rounded-lg transition-all ' + 
                   (activeChatId === chat.id ? 
                    'bg-sidebar-accent text-sidebar-accent-foreground shadow-sm' : 
                    'hover:bg-sidebar-accent/50 text-sidebar-foreground')">
          
          <div *ngIf="!isCollapsed" class="flex items-start gap-2">
            <svg class="h-4 w-4 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
            </svg>
            <div class="flex-1 min-w-0">
              <p class="text-sm font-medium truncate">{{ chat.title }}</p>
              <p class="text-xs text-muted-foreground truncate">{{ getChatPreview(chat) }}</p>
            </div>
            <button
              type="button"
              (click)="deleteChat(chat.id, $event)"
              class="h-6 w-6 flex items-center justify-center rounded hover:bg-destructive/10 hover:text-destructive">
              <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6M9 7h6m-7 0V5a2 2 0 012-2h3.999A2 2 0 0116 5v2m-7 0h8"></path>
              </svg>
            </button>
          </div>
          
          <div *ngIf="isCollapsed" class="flex justify-center">
            <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
            </svg>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- User Profile Section -->
  <div class="border-t border-sidebar-border p-3">
    <div *ngIf="!isCollapsed" class="flex items-center gap-3">
      <ng-container *ngIf="(currentUser$ | async) as user">
        <ng-container *ngIf="user?.picture; else defaultAvatar">
          <img
            [src]="user.picture"
            alt="Profile picture"
            class="h-8 w-8 rounded-full object-cover border border-sidebar-border"
            referrerpolicy="no-referrer"
          />
        </ng-container>
        <ng-template #defaultAvatar>
          <div class="h-8 w-8 rounded-full bg-primary text-primary-foreground flex items-center justify-center">
            <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
            </svg>
          </div>
        </ng-template>
      </ng-container>
      <div class="flex-1 min-w-0">
        <p class="text-sm font-medium truncate">{{ (currentUser$ | async)?.username || 'User' }}</p>
        <p class="text-xs text-muted-foreground">{{ (currentUser$ | async)?.email || 'user@example.com' }}</p>
      </div>
      <button
        type="button"
        (click)="logout()"
        class="h-8 w-8 hover:bg-destructive/10 hover:text-destructive flex items-center justify-center rounded-lg transition-colors">
        <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
        </svg>
      </button>
    </div>
    
    <div *ngIf="isCollapsed" class="flex flex-col items-center gap-2">
      <ng-container *ngIf="(currentUser$ | async) as user">
        <ng-container *ngIf="user?.picture; else defaultAvatarCollapsed">
          <img
            [src]="user.picture"
            alt="Profile picture"
            class="h-8 w-8 rounded-full object-cover border border-sidebar-border"
            referrerpolicy="no-referrer"
          />
        </ng-container>
        <ng-template #defaultAvatarCollapsed>
          <div class="h-8 w-8 rounded-full bg-primary text-primary-foreground flex items-center justify-center">
            <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
            </svg>
          </div>
        </ng-template>
      </ng-container>
      <button
        type="button"
        (click)="logout()"
        class="h-8 w-8 hover:bg-destructive/10 hover:text-destructive flex items-center justify-center rounded-lg transition-colors">
        <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
        </svg>
      </button>
    </div>
  </div>
</div> 